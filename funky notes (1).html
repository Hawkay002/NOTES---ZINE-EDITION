<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL NOTES /// ZINE EDITION</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@400;700&family=Source+Code+Pro&family=Comic+Neue:wght@400;700&family=Bebas+Neue&family=Press+Start+2P&family=Rubik+Mono+One&family=Fredoka+One&family=Baloo+2:wght@400;700&family=Modak&family=Poppins:wght=400;700&family=Archivo+Black&family=Ultra&family=Syne+Mono&family=Major+Mono+Display&family=Bungee&family=Bungee+Shade&family=Black+Ops+One&family=Abril+Fatface&family=Montserrat:wght@400;700&family=Oswald:wght@400;700&family=Raleway:wght@400;700&family=Quicksand:wght@400;700&family=Pacifico&family=Dancing+Script:wght@400;700&family=Caveat:wght@400;700&family=Kalam:wght@400;700&family=Amatic+SC:wght@400;700&family=Shadows+Into+Light&family=Indie+Flower&family=Special+Elite&family=VT323&family=IBM+Plex+Mono:wght@400;700&family=Space+Mono:wght@400;700&family=Work+Sans:wght@400;700&family=Fira+Sans:wght@400;400;700&family=Noto+Sans:wght@400;700&family=Open+Sans:wght@400;700&family=Merriweather:wght@400;700&family=Libre+Baskerville:wght@400;700&family=DM+Serif+Display&family=Alfa+Slab+One&family=Paytone+One&family=Luckiest+Guy&family=Chewy&family=Sigmar+One&family=Righteous&family=Lobster&family=Patua+One&family=Acme&family=Josefin+Sans:wght@400;700&family=Josefin+Slab:wght@400;700&family=Arvo:wght@400;700&family=Volkhov:wght@400;700&family=Crimson+Text:wght@400;700&family=Cardo:wght@400;700&family=Alegreya:wght@400;700&family=Yeseva+One&family=Philosopher:wght@400;700&family=Prata&family=Cormorant:wght@400;700&family=Unica+One&family=Changa+One&family=Staatliches&family=Knewave&family=Boogaloo&family=Bangers&family=Gloria+Hallelujah&family=Rock+Salt&family=Permanent+Marker&family=Nothing+You+Could+Do&family=Reenie+Beanie&family=Handlee&family=Gochi+Hand&family=Nanum+Pen+Script&family=Homemade+Apple&family=Covered+By+Your+Grace&family=Walter+Turncoat&family=Berkshire+Swash&family=Satisfy&family=Kaushan+Script&family=Marck+Script&family=Yellowtail&family=Great+Vibes&family=Parisienne&family=Qwigley&family=Tangerine:wght@400;700&family=Itim&family=Schoolbell&family=Short+Stack&family=Neucha&family=Annie+Use+Your+Telescope&family=Over+the+Rainbow&family=Sunshiney&family=Love+Ya+Like+A+Sister&family=Kranky&family=Mountains+of+Christmas&family=Butcherman&family=Eater&family=Creepster&family=Frijole&family=Rye&family=Smokum&family=UnifrakturMaguntia&family=Astloch:wght@400;700&family=Emblema+One&family=Faster+One&family=Federo&family=Gravitas+One&family=Monofett&family=Nosifer&family=Plaster&family=Ribeye+Marrow&family=Ribeye&family=Romanesco&family=Ruslan+Display&family=Skranji:wght@400;700&family=Stalinist+One&family=Trade+Winds&family=Underdog&family=Vast+Shadow&family=Vibur&family=Zilla+Slab+Highlight:wght@400;700&family=Fira+Mono:wght@400;700&family=Chivo+Mono:wght@400;700&family=Fragment+Mono&family=Red+Hat+Mono:wght@400;700&family=Share+Tech+Mono&family=Syne+Tactile&family=Tourney:wght@400;700&family=Martian+Mono:wght@400;700&family=JetBrains+Mono:wght@400;700&family=Anonymous+Pro:wght@400;700&display=swap">
    <style>
        :root {
            --primary-color: #FF0055; /* Hot Pink/Red */
            --secondary-color: #00E8D7; /* Electric Cyan */
            --accent-color: #FFF000; /* Blinding Yellow */
            --dark-color: #1A1A1A; /* Near Black */
            --light-color: #F5F5E0; /* Off-White/Creamy Background */
            --paper-color: #FFFFED; /* Brighter paper for notes */
            --shadow-size: 12px; /* Increased for dramatic effect */
            --border-size: 5px; /* Thicker borders */
            --tape-color: rgba(255, 100, 100, 0.7); /* More visible, red-tinted tape */
            --grid-line-color: rgba(26, 26, 26, 0.1); /* Darker grid lines */
            --noise-texture: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><rect fill="white" width="4" height="4"/><g fill="black" fill-opacity="0.1"><circle cx="1" cy="1" r="1"/><circle cx="3" cy="3" r="1"/></g></svg>');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background-color: var(--light-color);
            min-height: 100vh;
            padding: 20px;
            background-image:
                var(--noise-texture), /* Subtle noise texture */
                linear-gradient(var(--grid-line-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line-color) 1px, transparent 1px);
            background-size: 4px 4px, 20px 20px, 20px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
            color: var(--dark-color);
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path d="M10 0L0 10L10 20L20 10Z" fill="%23FF0055" stroke="%231A1A1A" stroke-width="2"/></svg>') 10 10, auto; /* Custom cursor */
        }

.font-option.font-monospace { font-family: 'Courier New', monospace; }
.font-option.font-sans { font-family: 'Arial', sans-serif; }
.font-option.font-serif { font-family: 'Times New Roman', serif; }
.font-option.font-roboto { font-family: 'Roboto', sans-serif; }
.font-option.font-playfair { font-family: 'Playfair Display', serif; }
.font-option.font-code { font-family: 'Source Code Pro', monospace; }
.font-option.font-comic { font-family: 'Comic Neue', cursive; }
.font-option.font-bebas { font-family: 'Bebas Neue', sans-serif; }
.font-option.font-pixel { font-family: 'Press Start 2P', cursive; }
.font-option.font-rubik { font-family: 'Rubik Mono One', sans-serif; }
.font-option.font-fredoka { font-family: 'Fredoka One', cursive; }
.font-option.font-baloo { font-family: 'Baloo 2', cursive; }
.font-option.font-modak { font-family: 'Modak', cursive; }
.font-option.font-poppins { font-family: 'Poppins', sans-serif; }
.font-option.font-archivo { font-family: 'Archivo Black', sans-serif; }
.font-option.font-ultra { font-family: 'Ultra', serif; }
.font-option.font-syne { font-family: 'Syne Mono', monospace; }
.font-option.font-major { font-family: 'Major Mono Display', monospace; }
.font-option.font-bungee { font-family: 'Bungee', cursive; }
.font-option.font-bungee-shade { font-family: 'Bungee Shade', cursive; }
.font-option.font-blackops { font-family: 'Black Ops One', cursive; }
.font-option.font-abril { font-family: 'Abril Fatface', cursive; }
.font-option.font-montserrat { font-family: 'Montserrat', sans-serif; }
.font-option.font-oswald { font-family: 'Oswald', sans-serif; }
.font-option.font-raleway { font-family: 'Raleway', sans-serif; }
.font-option.font-quicksand { font-family: 'Quicksand', sans-serif; }
.font-option.font-pacifico { font-family: 'Pacifico', cursive; }
.font-option.font-dancing { font-family: 'Dancing Script', cursive; }
.font-option.font-caveat { font-family: 'Caveat', cursive; }
.font-option.font-kalam { font-family: 'Kalam', cursive; }
.font-option.font-amatic { font-family: 'Amatic SC', cursive; }
.font-option.font-shadows { font-family: 'Shadows Into Light', cursive; }
.font-option.font-indie { font-family: 'Indie Flower', cursive; }
.font-option.font-special { font-family: 'Special Elite', cursive; }
.font-option.font-vt323 { font-family: 'VT323', monospace; }
.font-option.font-ibm { font-family: 'IBM Plex Mono', monospace; }
.font-option.font-space { font-family: 'Space Mono', monospace; }
.font-option.font-work { font-family: 'Work Sans', sans-serif; }
.font-option.font-fira { font-family: 'Fira Sans', sans-serif; }
.font-option.font-noto { font-family: 'Noto Sans', sans-serif; }
.font-option.font-open { font-family: 'Open Sans', sans-serif; }
.font-option.font-merriweather { font-family: 'Merriweather', serif; }
.font-option.font-libre { font-family: 'Libre Baskerville', serif; }
.font-option.font-dm { font-family: 'DM Serif Display', serif; }
.font-option.font-alfa { font-family: 'Alfa Slab One', cursive; }
.font-option.font-paytone { font-family: 'Paytone One', sans-serif; }
.font-option.font-luckiest { font-family: 'Luckiest Guy', cursive; }
.font-option.font-chewy { font-family: 'Chewy', cursive; }
.font-option.font-sigmar { font-family: 'Sigmar One', cursive; }
.font-option.font-righteous { font-family: 'Righteous', cursive; }
.font-option.font-lobster { font-family: 'Lobster', cursive; }
.font-option.font-patua { font-family: 'Patua One', cursive; }
.font-option.font-acme { font-family: 'Acme', sans-serif; }
.font-option.font-josefin { font-family: 'Josefin Sans', sans-serif; }
.font-option.font-josefin-slab { font-family: 'Josefin Slab', serif; }
.font-option.font-arvo { font-family: 'Arvo', serif; }
.font-option.font-volkhov { font-family: 'Volkhov', serif; }
.font-option.font-crimson { font-family: 'Crimson Text', serif; }
.font-option.font-cardo { font-family: 'Cardo', serif; }
.font-option.font-alegreya { font-family: 'Alegreya', serif; }
.font-option.font-yeseva { font-family: 'Yeseva One', cursive; }
.font-option.font-philosopher { font-family: 'Philosopher', sans-serif; }
.font-option.font-prata { font-family: 'Prata', serif; }
.font-option.font-cormorant { font-family: 'Cormorant', serif; }
.font-option.font-unica { font-family: 'Unica One', cursive; }
.font-option.font-changa { font-family: 'Changa One', cursive; }
.font-option.font-staat { font-family: 'Staatliches', cursive; }
.font-option.font-knewave { font-family: 'Knewave', cursive; }
.font-option.font-boogaloo { font-family: 'Boogaloo', cursive; }
.font-option.font-bangers { font-family: 'Bangers', cursive; }
.font-option.font-gloria { font-family: 'Gloria Hallelujah', cursive; }
.font-option.font-rock { font-family: 'Rock Salt', cursive; }
.font-option.font-marker { font-family: 'Permanent Marker', cursive; }
.font-option.font-nothing { font-family: 'Nothing You Could Do', cursive; }
.font-option.font-reenie { font-family: 'Reenie Beanie', cursive; }
.font-option.font-handlee { font-family: 'Handlee', cursive; }
.font-option.font-gochi { font-family: 'Gochi Hand', cursive; }
.font-option.font-nanum { font-family: 'Nanum Pen Script', cursive; }
.font-option.font-homemade { font-family: 'Homemade Apple', cursive; }
.font-option.font-covered { font-family: 'Covered By Your Grace', cursive; }
.font-option.font-walter { font-family: 'Walter Turncoat', cursive; }
.font-option.font-berkshire { font-family: 'Berkshire Swash', cursive; }
.font-option.font-satisfy { font-family: 'Satisfy', cursive; }
.font-option.font-kaushan { font-family: 'Kaushan Script', cursive; }
.font-option.font-marck { font-family: 'Marck Script', cursive; }
.font-option.font-yellowtail { font-family: 'Yellowtail', cursive; }
.font-option.font-great { font-family: 'Great Vibes', cursive; }
.font-option.font-parisienne { font-family: 'Parisienne', cursive; }
.font-option.font-qwigley { font-family: 'Qwigley', cursive; }
.font-option.font-tangerine { font-family: 'Tangerine', cursive; }
.font-option.font-itim { font-family: 'Itim', cursive; }
.font-option.font-schoolbell { font-family: 'Schoolbell', cursive; }
.font-option.font-short { font-family: 'Short Stack', cursive; }
.font-option.font-neucha { font-family: 'Neucha', cursive; }
.font-option.font-annie { font-family: 'Annie Use Your Telescope', cursive; }
.font-option.font-rainbow { font-family: 'Over the Rainbow', cursive; }
.font-option.font-sunshiney { font-family: 'Sunshiney', cursive; }
.font-option.font-love { font-family: 'Love Ya Like A Sister', cursive; }
.font-option.font-kranky { font-family: 'Kranky', cursive; }
.font-option.font-mountains { font-family: 'Mountains of Christmas', cursive; }
.font-option.font-butcherman { font-family: 'Butcherman', cursive; }
.font-option.font-eater { font-family: 'Eater', cursive; }
.font-option.font-creepster { font-family: 'Creepster', cursive; }
.font-option.font-frijole { font-family: 'Frijole', cursive; }
.font-option.font-rye { font-family: 'Rye', cursive; }
.font-option.font-smokum { font-family: 'Smokum', cursive; }
.font-option.font-unifraktur { font-family: 'UnifrakturMaguntia', cursive; }
.font-option.font-astloch { font-family: 'Astloch', cursive; }
.font-option.font-emblema { font-family: 'Emblema One', cursive; }
.font-option.font-faster { font-family: 'Faster One', cursive; }
.font-option.font-federo { font-family: 'Federo', sans-serif; }
.font-option.font-gravitas { font-family: 'Gravitas One', cursive; }
.font-option.font-monofett { font-family: 'Monofett', cursive; }
.font-option.font-nosifer { font-family: 'Nosifer', cursive; }
.font-option.font-plaster { font-family: 'Plaster', cursive; }
.font-option.font-ribeye-marrow { font-family: 'Ribeye Marrow', cursive; }
.font-option.font-ribeye { font-family: 'Ribeye', cursive; }
.font-option.font-romanesco { font-family: 'Romanesco', cursive; }
.font-option.font-ruslan { font-family: 'Ruslan Display', cursive; }
.font-option.font-skranji { font-family: 'Skranji', cursive; }
.font-option.font-stalinist { font-family: 'Stalinist One', cursive; }
.font-option.font-trade { font-family: 'Trade Winds', cursive; }
.font-option.font-underdog { font-family: 'Underdog', cursive; }
.font-option.font-vast { font-family: 'Vast Shadow', cursive; }
.font-option.font-vibur { font-family: 'Vibur', cursive; }
.font-option.font-zilla { font-family: 'Zilla Slab Highlight', cursive; }
.font-option.font-firamono { font-family: 'Fira Mono', monospace; }
.font-option.font-chivomono { font-family: 'Chivo Mono', monospace; }
.font-option.font-fragment { font-family: 'Fragment Mono', monospace; }
.font-option.font-redhatmono { font-family: 'Red Hat Mono', monospace; }
.font-option.font-sharetech { font-family: 'Share Tech Mono', monospace; }
.font-option.font-synetactile { font-family: 'Syne Tactile', cursive; }
.font-option.font-tourney { font-family: 'Tourney', cursive; }
.font-option.font-martian { font-family: 'Martian Mono', monospace; }
.font-option.font-jetbrains { font-family: 'JetBrains Mono', monospace; }
.font-option.font-anonymous { font-family: 'Anonymous Pro', monospace; }

        body::before {
            content: "";
            position: fixed; /* Use fixed for large background elements */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(
                    -45deg,
                    transparent,
                    transparent 10px,
                    rgba(26, 26, 26, 0.05) 10px,
                    rgba(26, 26, 26, 0.05) 20px
                );
            pointer-events: none;
            z-index: -2; /* Ensure it's below everything */
            mix-blend-mode: multiply; /* Adds to raw feel */
        }

        .app-container {
            width: 100%;
            max-width: 1100px; /* Slightly wider */
            margin: 20px auto;
            position: relative;
            z-index: 10;
        }

        .app-title {
            font-family: 'Bungee Shade', cursive;
            text-transform: uppercase;
            font-size: 4.5rem; /* Larger */
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 40px;
            letter-spacing: -5px; /* Tighter */
            position: relative;
            display: block; /* Force block to center */
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            padding: 15px 40px; /* More padding */
            border: var(--border-size) solid var(--dark-color);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--primary-color),
                        calc(var(--shadow-size) * 2) calc(var(--shadow-size) * 2) 0 var(--dark-color); /* Double shadow */
            background-color: var(--accent-color);
            line-height: 0.8; /* Tighter line height */
            transform: skewX(-5deg) rotate(-2deg); /* Aggressive tilt */
            transition: all 0.2s ease-in-out;
            cursor: default;
        }

        .app-title:hover {
            transform: skewX(-3deg) rotate(0deg) scale(1.02);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--primary-color),
                        calc(var(--shadow-size) * 1.5) calc(var(--shadow-size) * 1.5) 0 var(--dark-color);
        }

        .search-container {
            width: 100%;
            margin-bottom: 25px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px; /* More padding */
            border: var(--border-size) solid var(--dark-color);
            font-family: 'Source Code Pro', monospace;
            background-color: var(--paper-color);
            font-size: 1.1rem;
            box-shadow: 6px 6px 0 var(--secondary-color);
            transition: all 0.1s ease-out;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 3px 3px 0 var(--primary-color); /* Smaller focus shadow */
            transform: translate(3px, 3px);
        }

        .filter-buttons {
            display: flex;
            gap: 15px; /* More space */
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 18px; /* More padding */
            border: var(--border-size) solid var(--dark-color);
            background-color: var(--light-color);
            cursor: pointer;
            font-family: 'Archivo Black', sans-serif;
            font-size: 0.9rem;
            text-transform: uppercase;
            color: var(--dark-color);
            box-shadow: 4px 4px 0 var(--dark-color);
            transition: all 0.1s ease-out;
        }

        .filter-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--primary-color);
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: var(--light-color);
            box-shadow: 0 0 0 var(--dark-color);
            transform: translate(var(--border-size), var(--border-size)); /* Full press */
        }

        .controls {
            display: grid; /* Grid layout for better organization */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            padding: 30px;
            background-color: var(--accent-color);
            border: var(--border-size) solid var(--dark-color);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--primary-color),
                        calc(var(--shadow-size) * 1.5) calc(var(--shadow-size) * 1.5) 0 var(--dark-color);
            position: relative;
        }

        .controls::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px dashed rgba(26, 26, 26, 0.2);
            pointer-events: none;
            z-index: -1;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-input {
            padding: 10px;
            border: var(--border-size) solid var(--dark-color);
            font-family: 'Source Code Pro', monospace;
            background-color: var(--paper-color);
            font-size: 1rem;
            color: var(--dark-color);
            box-shadow: 3px 3px 0 var(--dark-color);
            transition: all 0.1s ease-out;
        }

        .control-input:focus {
            outline: none;
            box-shadow: 2px 2px 0 var(--primary-color);
            transform: translate(1px, 1px);
        }

        .btn {
            padding: 12px 20px;
            border: var(--border-size) solid var(--dark-color);
            background-color: var(--secondary-color);
            color: var(--dark-color); /* Changed text color for contrast */
            font-family: 'Archivo Black', sans-serif;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s ease-out;
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translate(-3px, -3px);
            box-shadow: calc(var(--shadow-size) + 3px) calc(var(--shadow-size) + 3px) 0 var(--primary-color);
        }

        .btn:active {
            transform: translate(var(--shadow-size), var(--shadow-size));
            box-shadow: 0 0 0 var(--dark-color);
            background-color: var(--primary-color); /* Active color change */
            color: var(--light-color);
        }

        .btn-secondary { background-color: var(--primary-color); color: var(--light-color); }
        .btn-secondary:hover { box-shadow: calc(var(--shadow-size) + 3px) calc(var(--shadow-size) + 3px) 0 var(--secondary-color); }
        .btn-secondary:active { background-color: var(--secondary-color); color: var(--dark-color); }

        .btn-tertiary { background-color: #3F49B0; color: var(--light-color); } /* Dark Blue */
        .btn-tertiary:hover { box-shadow: calc(var(--shadow-size) + 3px) calc(var(--shadow-size) + 3px) 0 var(--primary-color); }
        .btn-tertiary:active { background-color: var(--primary-color); }

        .btn-quaternary { background-color: #FF9F1C; color: var(--dark-color); } /* Orange */
        .btn-quaternary:hover { box-shadow: calc(var(--shadow-size) + 3px) calc(var(--shadow-size) + 3px) 0 var(--secondary-color); }
        .btn-quaternary:active { background-color: var(--secondary-color); }

        .btn-quinary { background-color: #4ECDC4; color: var(--dark-color); } /* Teal */
        .btn-quinary:hover { box-shadow: calc(var(--shadow-size) + 3px) calc(var(--shadow-size) + 3px) 0 var(--primary-color); }
        .btn-quinary:active { background-color: var(--primary-color); }

        .notes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 40px; /* More space between notes */
            width: 100%;
            padding: 20px;
            position: relative;
            z-index: 5;
        }

        .note {
            background-color: var(--paper-color);
            border: var(--border-size) solid var(--dark-color);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--secondary-color),
                        calc(var(--shadow-size) * 2) calc(var(--shadow-size) * 2) 0 var(--dark-color); /* Multi-layered shadow */
            padding: 25px; /* More padding */
            position: relative;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            min-height: 300px; /* Taller notes */
            overflow: hidden;
            transform: rotate(calc(var(--random-rotation) * 1deg)); /* Random rotation */
            transform-origin: center center;
            filter: url(#noiseFilter); /* Apply SVG noise filter */
        }

        .note::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--noise-texture); /* Paper noise texture on note */
            opacity: 0.4;
            pointer-events: none;
            z-index: 0;
        }

        .note:hover {
            transform: rotate(calc(var(--random-rotation) * 0.5deg)) scale(1.02); /* Slight scale and less rotation */
            box-shadow: calc(var(--shadow-size) + 5px) calc(var(--shadow-size) + 5px) 0 var(--primary-color),
                        calc(var(--shadow-size) * 1.5) calc(var(--shadow-size) * 1.5) 0 var(--dark-color);
            z-index: 20; /* Bring hovered note to front */
        }

        .note-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem; /* Larger */
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 4px solid var(--primary-color); /* Bold primary color line */
            color: var(--dark-color);
            text-transform: uppercase;
            letter-spacing: -1px;
            position: relative;
            z-index: 1; /* Above background texture */
        }

        .note-content {
            flex-grow: 1;
            outline: none;
            resize: none;
            background: transparent;
            border: none;
            font-family: inherit;
            line-height: 1.6; /* More relaxed line height */
            min-height: 120px;
            width: 100%;
            overflow-y: auto;
            word-wrap: break-word;
            white-space: pre-wrap;
            position: relative;
            z-index: 1;
            color: var(--dark-color);
        }

        .note-content:focus {
            outline: 2px dashed var(--primary-color); /* Dashed outline on focus */
            outline-offset: 4px;
        }

        .note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 3px dashed var(--dark-color); /* Thicker dashed line */
            position: relative;
            z-index: 1;
        }

        .note-date {
            font-size: 0.9rem;
            color: var(--dark-color);
            opacity: 0.8;
            font-family: 'Source Code Pro', monospace;
        }

        .note-actions {
            display: flex;
            gap: 10px; /* More space */
        }

        .note-btn {
            background: none;
            border: var(--border-size) solid var(--dark-color); /* Buttons have borders */
            cursor: pointer;
            font-size: 1.1rem; /* Larger icons */
            transition: all 0.1s ease-out;
            padding: 8px; /* Padding for click area */
            background-color: var(--light-color);
            box-shadow: 2px 2px 0 var(--dark-color);
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .note-btn:hover {
            transform: translate(-1px, -1px) scale(1.1);
            background-color: var(--accent-color);
            box-shadow: 3px 3px 0 var(--primary-color);
        }
        .note-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 var(--dark-color);
            background-color: var(--primary-color);
            color: var(--light-color);
        }

        .note-delete { color: var(--primary-color); border-color: var(--primary-color); }
        .note-delete:active { background-color: var(--primary-color); color: var(--light-color); }

        .note-pin { color: #3F49B0; border-color: #3F49B0; }
        .note-pin:active { background-color: #3F49B0; color: var(--light-color); }

        .note-color { color: var(--secondary-color); border-color: var(--secondary-color); }
        .note-color:active { background-color: var(--secondary-color); color: var(--dark-color); }

        .note-archive { color: #FF9F1C; border-color: #FF9F1C; }
        .note-archive:active { background-color: #FF9F1C; color: var(--light-color); }


        .tape {
            position: absolute;
            width: 80px; /* Wider tape */
            height: 25px; /* Taller tape */
            background-color: var(--tape-color);
            top: -12px; /* Slightly higher */
            left: 50%;
            transform: translateX(-50%) rotate(calc(var(--random-tape-rotation) * 1deg)); /* Random tape rotation */
            z-index: 10; /* Above note border */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); /* Clearer shadow */
            filter: contrast(1.2); /* Make tape more vibrant */
        }

        .pinned {
            border-left: 10px solid var(--primary-color); /* Highlight with primary color */
            order: -1;
            background-color: var(--paper-color);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--accent-color),
                        calc(var(--shadow-size) * 2) calc(var(--shadow-size) * 2) 0 var(--primary-color); /* Different shadow */
            transform: rotate(calc(var(--random-rotation) * 0.5deg)) scale(1.03); /* Slightly more prominent */
            z-index: 30; /* Ensure pinned notes are always on top */
        }

        .archived {
            opacity: 0.6; /* Slightly faded */
            background-color: var(--light-color); /* Lighter background when archived */
            filter: grayscale(80%) url(#noiseFilter); /* Greyscale and more noise */
            box-shadow: 5px 5px 0 rgba(0,0,0,0.2); /* Subtler shadow */
            transform: rotate(calc(var(--random-rotation) * 0.8deg)); /* Less prominent rotation */
            border-color: rgba(26, 26, 26, 0.5);
        }

        .color-picker {
            display: none;
            position: absolute;
            bottom: 60px; /* Higher above actions */
            right: 15px;
            background-color: var(--dark-color); /* Dark background for color picker */
            border: var(--border-size) solid var(--primary-color); /* Primary border */
            padding: 8px;
            z-index: 100;
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--accent-color);
            
            flex-wrap: wrap;
            gap: 5px;
        }

        .color-option {
            width: 30px; /* Larger options */
            height: 30px;
            margin: 0; /* Remove default margin */
            cursor: pointer;
            border: 3px solid var(--light-color); /* Light border for options */
            transition: transform 0.1s ease-in-out, border-color 0.1s ease-in-out;
            box-shadow: 1px 1px 0 rgba(0,0,0,0.3);
        }

        .color-option:hover {
            transform: scale(1.15);
            border-color: var(--accent-color); /* Hover highlight */
        }

        .color-option.selected {
            border-color: var(--primary-color); /* Primary highlight for selected */
            transform: scale(1.1);
            box-shadow: 2px 2px 0 var(--accent-color);
        }

        /* Note colors */
        .note-color-default { background-color: var(--paper-color); }
        .note-color-red { background-color: #FFDDDD; }
        .note-color-blue { background-color: #DDDDFF; }
        .note-color-green { background-color: #DDFFDD; }
        .note-color-yellow { background-color: #FFFFDD; }
        .note-color-purple { background-color: #FFDDFF; }


        .no-notes {
            text-align: center;
            padding: 50px;
            font-size: 1.5rem;
            color: var(--dark-color);
            opacity: 0.8;
            grid-column: 1 / -1;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            background-color: var(--light-color);
            border: var(--border-size) dashed var(--primary-color);
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--dark-color);
        }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .app-title {
                font-size: 3rem;
                letter-spacing: -2px;
                padding: 10px 20px;
                transform: skewX(-3deg) rotate(-1deg);
            }
            .notes-container {
                grid-template-columns: 1fr;
                gap: 25px;
            }
            .controls {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 15px;
            }
            .btn { width: 100%; }
            .note { min-height: 200px; }
            .note-header { font-size: 1.5rem; }
            .search-input { font-size: 1rem; }
        }

        /* Slider styles within notes */
        .note .slider-container {
            width: 100%;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-top: 2px dashed var(--dark-color);
            border-bottom: 2px dashed var(--dark-color);
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        .note .slider-value {
            min-width: 35px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
        }

        .note .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 12px; /* Thicker slider track */
            background: var(--light-color);
            outline: none;
            border: var(--border-size) solid var(--dark-color);
            box-shadow: inset 1px 1px 0 rgba(0,0,0,0.2); /* Inset shadow for track */
            transition: all 0.1s ease-out;
        }

        .note .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px; /* Larger thumb */
            height: 25px;
            background: var(--primary-color);
            cursor: pointer;
            border: var(--border-size) solid var(--dark-color);
            box-shadow: 2px 2px 0 var(--dark-color);
            transition: all 0.1s ease-out;
        }

        .note .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 3px 3px 0 var(--secondary-color);
        }

        .note .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: var(--primary-color);
            cursor: pointer;
            border: var(--border-size) solid var(--dark-color);
            box-shadow: 2px 2px 0 var(--dark-color);
            transition: all 0.1s ease-out;
        }
        .note .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 3px 3px 0 var(--secondary-color);
        }

        /* Font dropdown within notes */
        .note .font-dropdown {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
            position: relative;
            z-index: 4;
        }

        .note .font-dropdown-btn {
            width: 100%;
            padding: 10px;
            border: var(--border-size) solid var(--dark-color);
            background-color: var(--light-color);
            font-family: 'Source Code Pro', monospace;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--dark-color);
            box-shadow: 3px 3px 0 var(--dark-color);
            transition: all 0.1s ease-out;
            font-size: 1.3rem;
            overflow-y: hidden;
        }

        .note .font-dropdown-btn:hover {
            transform: translate(-1px, -1px);
            box-shadow: 4px 4px 0 var(--primary-color);
        }
        .note .font-dropdown-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 var(--dark-color);
        }


        .note .font-dropdown-content {
            display: none;
            position: absolute;
            width: 100%;
            font-size: 1.1rem;
            max-height: 250px; /* Shorter for less scroll */
            overflow-y: auto;
            border: var(--border-size) solid var(--primary-color); /* Highlight dropdown border */
            background-color: var(--dark-color); /* Dark background for font list */
            z-index: 50; /* Higher z-index */
            box-shadow: var(--shadow-size) var(--shadow-size) 0 var(--accent-color);
        }

        .note .font-dropdown-content.show {
            display: block;
        }

        .note .font-option {
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.1s ease-out;
            color: var(--light-color); /* Light text on dark background */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Subtle separator */
        }
        .note .font-option:last-child { border-bottom: none; }

        .note .font-option:hover {
            background-color: var(--primary-color); /* Highlight selected font */
            transform: translateX(5px);
            color: var(--dark-color); /* Dark text on primary hover */
        }

        /* Formatting controls within notes */
        .format-controls {
            display: flex;
            gap: 8px; /* More space */
            margin-bottom: 15px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .format-btn {
            padding: 8px 12px;
            border: 3px solid var(--dark-color); /* Thicker border */
            background-color: var(--light-color);
            cursor: pointer;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9rem;
            transition: all 0.1s ease-out;
            box-shadow: 2px 2px 0 var(--dark-color);
            color: var(--dark-color);
        }

        .format-btn:hover {
            background-color: var(--accent-color);
            transform: translate(-1px, -1px);
            box-shadow: 3px 3px 0 var(--primary-color);
        }

        .format-btn.active {
            background-color: var(--primary-color);
            color: var(--light-color);
            box-shadow: 0 0 0 var(--dark-color);
            transform: translate(2px, 2px); /* Full press effect */
        }

        /* Specific styles for color input */
        .format-btn[data-command="foreColor"] {
            padding: 0; /* Remove padding */
            width: 40px; /* Fixed width */
            height: 38px; /* Fixed height */
            border-radius: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            cursor: pointer;
        }

        .format-btn[data-command="foreColor"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .format-btn[data-command="foreColor"]::-webkit-color-swatch {
            border: none;
            border-radius: 0;
        }

        /* Scrapbook elements */
        .scrapbook-element {
            position: fixed;
            opacity: 0.07; /* Slightly more subtle, blend with background */
            pointer-events: none;
            z-index: -1;
            font-family: 'Black Ops One', cursive; /* More aggressive font */
            color: var(--dark-color);
            white-space: nowrap; /* Prevent wrapping */
            text-transform: uppercase;
        }

        .scrapbook-element:nth-child(1) {
            top: 3%;
            left: 3%;
            font-size: 7rem; /* Larger */
            transform: rotate(-15deg) skewX(-5deg); /* More dramatic */
            letter-spacing: -5px;
        }

        .scrapbook-element:nth-child(2) {
            bottom: 5%;
            right: 5%;
            font-size: 6rem;
            transform: rotate(10deg) skewX(3deg);
            letter-spacing: -3px;
        }

        .scrapbook-element:nth-child(3) {
            top: 20%;
            right: 10%;
            font-size: 5rem;
            transform: rotate(5deg) skewX(2deg);
            letter-spacing: -2px;
        }

        .scrapbook-element:nth-child(4) {
            top: 60%;
            left: 5%;
            font-size: 4rem;
            transform: rotate(-8deg) skewX(-2deg);
        }

        .scrapbook-element:nth-child(5) {
            bottom: 15%;
            left: 15%;
            font-size: 3.5rem;
            transform: rotate(20deg) skewX(4deg);
        }

        /* Screenshot flash animation */
        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.9; } /* Brighter flash */
            100% { opacity: 0; }
        }

        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--paper-color); /* Flash color */
            z-index: 9999;
            pointer-events: none;
            animation: flash 0.4s ease-out; /* Faster flash */
        }

        /* Export/Import buttons */
        .data-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Priority system */
        .priority-high {
            border-top: 10px solid var(--primary-color);
            background-color: var(--paper-color); /* Ensure background is normal for priority */
        }

        .priority-medium {
            border-top: 10px solid #FF9F1C; /* Orange */
            background-color: var(--paper-color);
        }

        .priority-low {
            border-top: 10px solid var(--secondary-color);
            background-color: var(--paper-color);
        }

        /* Animation for new notes */
        @keyframes noteAppear {
            0% { transform: scale(0.6) rotate(30deg); opacity: 0; }
            60% { transform: scale(1.05) rotate(-5deg); opacity: 1; }
            100% { transform: scale(1) rotate(var(--random-rotation) * 1deg); opacity: 1; }
        }

        .note.new-note {
            animation: noteAppear 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Springy animation */
        }
    </style>
</head>
<body>
    <svg style="position: absolute; width: 0; height: 0;">
        <filter id="noiseFilter">
            <feTurbulence type="fractalNoise" baseFrequency="0.6" numOctaves="3" stitchTiles="stitch" />
            <feColorMatrix type="saturate" values="0" />
            <feComposite operator="in" in2="SourceGraphic" result="monoNoise"/>
            <feBlend in="SourceGraphic" in2="monoNoise" mode="multiply" />
        </filter>
    </svg>

    <div class="app-container">
        <h1 class="app-title" style="font-family:  'IBM Plex Mono', monospace !important;">NOTES /// ZINE EDITION</h1>

        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="SEARCH OR BE LOST...">
        </div>

        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">All Entries</button>
            <button class="filter-btn" data-filter="pinned">Pinned Rants</button>
            <button class="filter-btn" data-filter="archived">Archived Scraps</button>
            <button class="filter-btn" data-filter="high">Urgent</button>
            <button class="filter-btn" data-filter="medium">Mid-Level</button>
            <button class="filter-btn" data-filter="low">Low Priority</button>
        </div>

        <div class="controls">
            <div class="control-group">
                <label class="control-label" for="note-title">
                    <i class="fas fa-hammer"></i> TITLE YOUR MARK
                </label>
                <input type="text" id="note-title" class="control-input" placeholder="UNTITLED ENTRY">
            </div>

            <div class="control-group">
                <label class="control-label">
                    <i class="fas fa-exclamation-triangle"></i> SET PRIORITY
                </label>
                <select id="note-priority" class="control-input">
                    <option value="none">NONE</option>
                    <option value="high">UR</option>
                    <option value="medium">MEDIUM</option>
                    <option value="low">LOW</option>
                </select>
            </div>

            <button id="add-note" class="btn">
                <i class="fas fa-plus-circle"></i> ADD NEW ENTRY
            </button>
            <button id="clear-all" class="btn btn-secondary">
                <i class="fas fa-burn"></i> BURN ALL
            </button>
            <button id="export-notes" class="btn btn-quaternary">
                <i class="fas fa-file-export"></i> EXPORT MANIFESTO
            </button>
            <button id="import-notes" class="btn btn-quinary">
                <i class="fas fa-file-import"></i> IMPORT SCROLLS
            </button>
            <button id="toggle-archived" class="btn btn-tertiary">
                <i class="fas fa-eye"></i> SHOW ARCHIVED
            </button>
            <button id="capture-screen" class="btn btn-tertiary">
                <i class="fas fa-camera"></i> CAPTURE WALL
            </button>
        </div>

        <div class="notes-container" id="notes-container">
            </div>

        <div class="data-actions">
            <input type="file" id="import-file" style="display: none;" accept=".json">
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const notesContainer = document.getElementById('notes-container');
            const addNoteBtn = document.getElementById('add-note');
            const clearAllBtn = document.getElementById('clear-all');
            const captureScreenBtn = document.getElementById('capture-screen');
            const exportNotesBtn = document.getElementById('export-notes');
            const importNotesBtn = document.getElementById('import-notes');
            const importFileInput = document.getElementById('import-file');
            const toggleArchivedBtn = document.getElementById('toggle-archived');
            const noteTitleInput = document.getElementById('note-title');
            const searchInput = document.getElementById('search-input');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const notePrioritySelect = document.getElementById('note-priority');

            // Current settings (global defaults for new notes)
            let defaultFontSize = 16;
            let defaultFontFamily = "'Source Code Pro', monospace";
            let defaultFontName = "Source Code Pro";
            let defaultColor = "default";
            let currentFilter = "all";
            let showArchived = localStorage.getItem('brutal-notes-show-archived') === 'true'; // Load archived state

            // Update toggle button text on load
            toggleArchivedBtn.innerHTML = showArchived ?
                '<i class="fas fa-eye-slash"></i> HIDE ARCHIVED' :
                '<i class="fas fa-eye"></i> SHOW ARCHIVED';

            // Load notes from localStorage
            loadNotes();
            filterNotes(); // Apply initial filter on load

            // Event listeners
            addNoteBtn.addEventListener('click', addNewNote);
            clearAllBtn.addEventListener('click', clearAllNotes);
            captureScreenBtn.addEventListener('click', captureScreen);
            exportNotesBtn.addEventListener('click', exportNotes);
            importNotesBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', importNotes);
            toggleArchivedBtn.addEventListener('click', toggleArchivedNotes);
            searchInput.addEventListener('input', filterNotes);

            // Filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    filterNotes();
                });
            });

            // Functions
            function addNewNote() {
                const title = noteTitleInput.value.trim() || 'UNTITLED ENTRY';
                const now = new Date();
                const dateString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
                const priority = notePrioritySelect.value;

                const noteId = Date.now().toString();
                const randomRotation = (Math.random() * 4 - 2).toFixed(2); // -2 to 2 degrees
                const randomTapeRotation = (Math.random() * 10 - 5).toFixed(2); // -5 to 5 degrees

                const noteElement = document.createElement('div');
                noteElement.className = `note new-note note-color-${defaultColor}`;
                noteElement.dataset.id = noteId;
                noteElement.dataset.priority = priority;
                noteElement.dataset.fontSize = defaultFontSize; // Store font size
                noteElement.dataset.fontFamily = defaultFontFamily; // Store font family
                noteElement.dataset.fontName = defaultFontName; // Store font name
                noteElement.style.setProperty('--random-rotation', randomRotation); // Apply random rotation
                noteElement.style.setProperty('--random-tape-rotation', randomTapeRotation); // Apply random tape rotation


                noteElement.innerHTML = `
                    <div class="tape"></div>
                    <h3 class="note-header" contenteditable="true">${title}</h3>
                    <div class="format-controls">
                        <button class="format-btn" data-command="bold" title="BOLD"><i class="fas fa-bold"></i></button>
                        <button class="format-btn" data-command="italic" title="ITALIC"><i class="fas fa-italic"></i></button>
                        <button class="format-btn" data-command="underline" title="UNDERLINE"><i class="fas fa-underline"></i></button>
                        <button class="format-btn" data-command="justifyLeft" title="LEFT ALIGN"><i class="fas fa-align-left"></i></button>
                        <button class="format-btn" data-command="justifyCenter" title="CENTER ALIGN"><i class="fas fa-align-center"></i></button>
                        <button class="format-btn" data-command="justifyRight" title="RIGHT ALIGN"><i class="fas fa-align-right"></i></button>
                        <input type="color" class="format-btn" data-command="foreColor" title="FONT COLOR" value="#1A1A1A">
                    </div>
                    <div class="slider-container">
                        <label class="control-label"><i class="fas fa-text-height"></i> FONT SIZE</label>
                        <input type="range" min="8" max="48" value="${defaultFontSize}" class="slider font-size-slider">
                        <span class="slider-value">${defaultFontSize}</span>
                    </div>
                    <div class="font-dropdown">
                        <button class="font-dropdown-btn">
                            <span class="selected-font">${defaultFontName}</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="font-dropdown-content">
                            <div class="font-option font-monospace" data-font="'Courier New', monospace" data-font-name="Monospace">Monospace</div>
                            <div class="font-option font-sans" data-font="'Arial', sans-serif" data-font-name="Sans">Sans</div>
                            <div class="font-option font-serif" data-font="'Times New Roman', serif" data-font-name="Serif">Serif</div>
                            <div class="font-option font-roboto" data-font="'Roboto', sans-serif" data-font-name="Roboto">Roboto</div>
                            <div class="font-option font-playfair" data-font="'Playfair Display', serif" data-font-name="Playfair">Playfair</div>
                            <div class="font-option font-code" data-font="'Source Code Pro', monospace" data-font-name="Source Code Pro">Source Code Pro</div>
                            <div class="font-option font-comic" data-font="'Comic Neue', cursive" data-font-name="Comic Neue">Comic Neue</div>
                            <div class="font-option font-bebas" data-font="'Bebas Neue', sans-serif" data-font-name="Bebas Neue">Bebas Neue</div>
                            <div class="font-option font-pixel" data-font="'Press Start 2P', cursive" data-font-name="Press Start 2P">Press Start 2P</div>
                            <div class="font-option font-rubik" data-font="'Rubik Mono One', sans-serif" data-font-name="Rubik Mono One">Rubik Mono One</div>
                            <div class="font-option font-fredoka" data-font="'Fredoka One', cursive" data-font-name="Fredoka One">Fredoka One</div>
                            <div class="font-option font-baloo" data-font="'Baloo 2', cursive" data-font-name="Baloo 2">Baloo 2</div>
                            <div class="font-option font-modak" data-font="'Modak', cursive" data-font-name="Modak">Modak</div>
                            <div class="font-option font-poppins" data-font="'Poppins', sans-serif" data-font-name="Poppins">Poppins</div>
                            <div class="font-option font-archivo" data-font="'Archivo Black', sans-serif" data-font-name="Archivo Black">Archivo Black</div>
                            <div class="font-option font-ultra" data-font="'Ultra', serif" data-font-name="Ultra">Ultra</div>
                            <div class="font-option font-syne" data-font="'Syne Mono', monospace" data-font-name="Syne Mono">Syne Mono</div>
                            <div class="font-option font-major" data-font="'Major Mono Display', monospace" data-font-name="Major Mono Display">Major Mono Display</div>
                            <div class="font-option font-bungee" data-font="'Bungee', cursive" data-font-name="Bungee">Bungee</div>
                            <div class="font-option font-bungee-shade" data-font="'Bungee Shade', cursive" data-font-name="Bungee Shade">Bungee Shade</div>
                            <div class="font-option font-blackops" data-font="'Black Ops One', cursive" data-font-name="Black Ops One">Black Ops One</div>
                            <div class="font-option font-abril" data-font="'Abril Fatface', cursive" data-font-name="Abril Fatface">Abril Fatface</div>
                            <div class="font-option font-montserrat" data-font="'Montserrat', sans-serif" data-font-name="Montserrat">Montserrat</div>
                            <div class="font-option font-oswald" data-font="'Oswald', sans-serif" data-font-name="Oswald">Oswald</div>
                            <div class="font-option font-raleway" data-font="'Raleway', sans-serif" data-font-name="Raleway">Raleway</div>
                            <div class="font-option font-quicksand" data-font="'Quicksand', sans-serif" data-font-name="Quicksand">Quicksand</div>
                            <div class="font-option font-pacifico" data-font="'Pacifico', cursive" data-font-name="Pacifico">Pacifico</div>
                            <div class="font-option font-dancing" data-font="'Dancing Script', cursive" data-font-name="Dancing Script">Dancing Script</div>
                            <div class="font-option font-caveat" data-font="'Caveat', cursive" data-font-name="Caveat">Caveat</div>
                            <div class="font-option font-kalam" data-font="'Kalam', cursive" data-font-name="Kalam">Kalam</div>
                            <div class="font-option font-amatic" data-font="'Amatic SC', cursive" data-font-name="Amatic SC">Amatic SC</div>
                            <div class="font-option font-shadows" data-font="'Shadows Into Light', cursive" data-font-name="Shadows Into Light">Shadows Into Light</div>
                            <div class="font-option font-indie" data-font="'Indie Flower', cursive" data-font-name="Indie Flower">Indie Flower</div>
                            <div class="font-option font-special" data-font="'Special Elite', cursive" data-font-name="Special Elite">Special Elite</div>
                            <div class="font-option font-vt323" data-font="'VT323', monospace" data-font-name="VT323">VT323</div>
                            <div class="font-option font-ibm" data-font="'IBM Plex Mono', monospace" data-font-name="IBM Plex Mono">IBM Plex Mono</div>
                            <div class="font-option font-space" data-font="'Space Mono', monospace" data-font-name="Space Mono">Space Mono</div>
                            <div class="font-option font-work" data-font="'Work Sans', sans-serif" data-font-name="Work Sans">Work Sans</div>
                            <div class="font-option font-fira" data-font="'Fira Sans', sans-serif" data-font-name="Fira Sans">Fira Sans</div>
                            <div class="font-option font-noto" data-font="'Noto Sans', sans-serif" data-font-name="Noto Sans">Noto Sans</div>
                            <div class="font-option font-open" data-font="'Open Sans', sans-serif" data-font-name="Open Sans">Open Sans</div>
                            <div class="font-option font-merriweather" data-font="'Merriweather', serif" data-font-name="Merriweather">Merriweather</div>
                            <div class="font-option font-libre" data-font="'Libre Baskerville', serif" data-font-name="Libre Baskerville">Libre Baskerville</div>
                            <div class="font-option font-dm" data-font="'DM Serif Display', serif" data-font-name="DM Serif Display">DM Serif Display</div>
                            <div class="font-option font-alfa" data-font="'Alfa Slab One', cursive" data-font-name="Alfa Slab One">Alfa Slab One</div>
                            <div class="font-option font-paytone" data-font="'Paytone One', sans-serif" data-font-name="Paytone One">Paytone One</div>
                            <div class="font-option font-luckiest" data-font="'Luckiest Guy', cursive" data-font-name="Luckiest Guy">Luckiest Guy</div>
                            <div class="font-option font-chewy" data-font="'Chewy', cursive" data-font-name="Chewy">Chewy</div>
                            <div class="font-option font-sigmar" data-font="'Sigmar One', cursive" data-font-name="Sigmar One">Sigmar One</div>
                            <div class="font-option font-righteous" data-font="'Righteous', cursive" data-font-name="Righteous">Righteous</div>
                            <div class="font-option font-lobster" data-font="'Lobster', cursive" data-font-name="Lobster">Lobster</div>
                            <div class="font-option font-patua" data-font="'Patua One', cursive" data-font-name="Patua One">Patua One</div>
                            <div class="font-option font-acme" data-font="'Acme', sans-serif" data-font-name="Acme">Acme</div>
                            <div class="font-option font-josefin" data-font="'Josefin Sans', sans-serif" data-font-name="Josefin Sans">Josefin Sans</div>
                            <div class="font-option font-josefin-slab" data-font="'Josefin Slab', serif" data-font-name="Josefin Slab">Josefin Slab</div>
                            <div class="font-option font-arvo" data-font="'Arvo', serif" data-font-name="Arvo">Arvo</div>
                            <div class="font-option font-volkhov" data-font="'Volkhov', serif" data-font-name="Volkhov">Volkhov</div>
                            <div class="font-option font-crimson" data-font="'Crimson Text', serif" data-font-name="Crimson Text">Crimson Text</div>
                            <div class="font-option font-cardo" data-font="'Cardo', serif" data-font-name="Cardo">Cardo</div>
                            <div class="font-option font-alegreya" data-font="'Alegreya', serif" data-font-name="Alegreya">Alegreya</div>
                            <div class="font-option font-yeseva" data-font="'Yeseva One', cursive" data-font-name="Yeseva One">Yeseva One</div>
                            <div class="font-option font-philosopher" data-font="'Philosopher', sans-serif" data-font-name="Philosopher">Philosopher</div>
                            <div class="font-option font-prata" data-font="'Prata', serif" data-font-name="Prata">Prata</div>
                            <div class="font-option font-cormorant" data-font="'Cormorant', serif" data-font-name="Cormorant">Cormorant</div>
                            <div class="font-option font-unica" data-font="'Unica One', cursive" data-font-name="Unica One">Unica One</div>
                            <div class="font-option font-changa" data-font="'Changa One', cursive" data-font-name="Changa One">Changa One</div>
                            <div class="font-option font-staat" data-font="'Staatliches', cursive" data-font-name="Staatliches">Staatliches</div>
                            <div class="font-option font-knewave" data-font="'Knewave', cursive" data-font-name="Knewave">Knewave</div>
                            <div class="font-option font-boogaloo" data-font="'Boogaloo', cursive" data-font-name="Boogaloo">Boogaloo</div>
                            <div class="font-option font-bangers" data-font="'Bangers', cursive" data-font-name="Bangers">Bangers</div>
                            <div class="font-option font-gloria" data-font="'Gloria Hallelujah', cursive" data-font-name="Gloria Hallelujah">Gloria Hallelujah</div>
                            <div class="font-option font-rock" data-font="'Rock Salt', cursive" data-font-name="Rock Salt">Rock Salt</div>
                            <div class="font-option font-marker" data-font="'Permanent Marker', cursive" data-font-name="Permanent Marker">Permanent Marker</div>
                            <div class="font-option font-nothing" data-font="'Nothing You Could Do', cursive" data-font-name="Nothing You Could Do">Nothing You Could Do</div>
                            <div class="font-option font-reenie" data-font="'Reenie Beanie', cursive" data-font-name="Reenie Beanie">Reenie Beanie</div>
                            <div class="font-option font-handlee" data-font="'Handlee', cursive" data-font-name="Handlee">Handlee</div>
                            <div class="font-option font-gochi" data-font="'Gochi Hand', cursive" data-font-name="Gochi Hand">Gochi Hand</div>
                            <div class="font-option font-nanum" data-font="'Nanum Pen Script', cursive" data-font-name="Nanum Pen Script">Nanum Pen Script</div>
                            <div class="font-option font-homemade" data-font="'Homemade Apple', cursive" data-font-name="Homemade Apple">Homemade Apple</div>
                            <div class="font-option font-covered" data-font="'Covered By Your Grace', cursive" data-font-name="Covered By Your Grace">Covered By Your Grace</div>
                            <div class="font-option font-walter" data-font="'Walter Turncoat', cursive" data-font-name="Walter Turncoat">Walter Turncoat</div>
                            <div class="font-option font-berkshire" data-font="'Berkshire Swash', cursive" data-font-name="Berkshire Swash">Berkshire Swash</div>
                            <div class="font-option font-satisfy" data-font="'Satisfy', cursive" data-font-name="Satisfy">Satisfy</div>
                            <div class="font-option font-kaushan" data-font="'Kaushan Script', cursive" data-font-name="Kaushan Script">Kaushan Script</div>
                            <div class="font-option font-marck" data-font="'Marck Script', cursive" data-font-name="Marck Script">Marck Script</div>
                            <div class="font-option font-yellowtail" data-font="'Yellowtail', cursive" data-font-name="Yellowtail">Yellowtail</div>
                            <div class="font-option font-great" data-font="'Great Vibes', cursive" data-font-name="Great Vibes">Great Vibes</div>
                            <div class="font-option font-parisienne" data-font="'Parisienne', cursive" data-font-name="Parisienne">Parisienne</div>
                            <div class="font-option font-qwigley" data-font="'Qwigley', cursive" data-font-name="Qwigley">Qwigley</div>
                            <div class="font-option font-tangerine" data-font="'Tangerine', cursive" data-font-name="Tangerine">Tangerine</div>
                            <div class="font-option font-itim" data-font="'Itim', cursive" data-font-name="Itim">Itim</div>
                            <div class="font-option font-schoolbell" data-font="'Schoolbell', cursive" data-font-name="Schoolbell">Schoolbell</div>
                            <div class="font-option font-short" data-font="'Short Stack', cursive" data-font-name="Short Stack">Short Stack</div>
                            <div class="font-option font-neucha" data-font="'Neucha', cursive" data-font-name="Neucha">Neucha</div>
                            <div class="font-option font-annie" data-font="'Annie Use Your Telescope', cursive" data-font-name="Annie Use Your Telescope">Annie Use Your Telescope</div>
                            <div class="font-option font-rainbow" data-font="'Over the Rainbow', cursive" data-font-name="Over the Rainbow">Over the Rainbow</div>
                            <div class="font-option font-sunshiney" data-font="'Sunshiney', cursive" data-font-name="Sunshiney">Sunshiney</div>
                            <div class="font-option font-love" data-font="'Love Ya Like A Sister', cursive" data-font-name="Love Ya Like A Sister">Love Ya Like A Sister</div>
                            <div class="font-option font-kranky" data-font="'Kranky', cursive" data-font-name="Kranky">Kranky</div>
                            <div class="font-option font-mountains" data-font="'Mountains of Christmas', cursive" data-font-name="Mountains of Christmas">Mountains of Christmas</div>
                            <div class="font-option font-butcherman" data-font="'Butcherman', cursive" data-font-name="Butcherman">Butcherman</div>
                            <div class="font-option font-eater" data-font="'Eater', cursive" data-font-name="Eater">Eater</div>
                            <div class="font-option font-creepster" data-font="'Creepster', cursive" data-font-name="Creepster">Creepster</div>
                            <div class="font-option font-frijole" data-font="'Frijole', cursive" data-font-name="Frijole">Frijole</div>
                            <div class="font-option font-rye" data-font="'Rye', cursive" data-font-name="Rye">Rye</div>
                            <div class="font-option font-smokum" data-font="'Smokum', cursive" data-font-name="Smokum">Smokum</div>
                            <div class="font-option font-unifraktur" data-font="'UnifrakturMaguntia', cursive" data-font-name="UnifrakturMaguntia">UnifrakturMaguntia</div>
                            <div class="font-option font-astloch" data-font="'Astloch', cursive" data-font-name="Astloch">Astloch</div>
                            <div class="font-option font-emblema" data-font="'Emblema One', cursive" data-font-name="Emblema One">Emblema One</div>
                            <div class="font-option font-faster" data-font="'Faster One', cursive" data-font-name="Faster One">Faster One</div>
                            <div class="font-option font-federo" data-font="'Federo', sans-serif" data-font-name="Federo">Federo</div>
                            <div class="font-option font-gravitas" data-font="'Gravitas One', cursive" data-font-name="Gravitas One">Gravitas One</div>
                            <div class="font-option font-monofett" data-font="'Monofett', cursive" data-font-name="Monofett">Monofett</div>
                            <div class="font-option font-nosifer" data-font="'Nosifer', cursive" data-font-name="Nosifer">Nosifer</div>
                            <div class="font-option font-plaster" data-font="'Plaster', cursive" data-font-name="Plaster">Plaster</div>
                            <div class="font-option font-ribeye-marrow" data-font="'Ribeye Marrow', cursive" data-font-name="Ribeye Marrow">Ribeye Marrow</div>
                            <div class="font-option font-ribeye" data-font="'Ribeye', cursive" data-font-name="Ribeye">Ribeye</div>
                            <div class="font-option font-romanesco" data-font="'Romanesco', cursive" data-font-name="Romanesco">Romanesco</div>
                            <div class="font-option font-ruslan" data-font="'Ruslan Display', cursive" data-font-name="Ruslan Display">Ruslan Display</div>
                            <div class="font-option font-skranji" data-font="'Skranji', cursive" data-font-name="Skranji">Skranji</div>
                            <div class="font-option font-stalinist" data-font="'Stalinist One', cursive" data-font-name="Stalinist One">Stalinist One</div>
                            <div class="font-option font-trade" data-font="'Trade Winds', cursive" data-font-name="Trade Winds">Trade Winds</div>
                            <div class="font-option font-underdog" data-font="'Underdog', cursive" data-font-name="Underdog">Underdog</div>
                            <div class="font-option font-vast" data-font="'Vast Shadow', cursive" data-font-name="Vast Shadow">Vast Shadow</div>
                            <div class="font-option font-vibur" data-font="'Vibur', cursive" data-font-name="Vibur">Vibur</div>
                            <div class="font-option font-zilla" data-font="'Zilla Slab Highlight', cursive" data-font-name="Zilla Slab Highlight">Zilla Slab Highlight</div>
                            <div class="font-option font-firamono" data-font="'Fira Mono', monospace" data-font-name="Fira Mono">Fira Mono</div>
                            <div class="font-option font-chivomono" data-font="'Chivo Mono', monospace" data-font-name="Chivo Mono">Chivo Mono</div>
                            <div class="font-option font-fragment" data-font="'Fragment Mono', monospace" data-font-name="Fragment">Fragment</div>
                            <div class="font-option font-redhatmono" data-font="'Red Hat Mono', monospace" data-font-name="Red Hat Mono">Red Hat Mono</div>
                            <div class="font-option font-sharetech" data-font="'Share Tech Mono', monospace" data-font-name="Share Tech">Share Tech</div>
                            <div class="font-option font-synetactile" data-font="'Syne Tactile', cursive" data-font-name="Syne Tactile">Syne Tactile</div>
                            <div class="font-option font-tourney" data-font="'Tourney', cursive" data-font-name="Tourney">Tourney</div>
                            <div class="font-option font-martian" data-font="'Martian Mono', monospace" data-font-name="Martian">Martian</div>
                            <div class="font-option font-jetbrains" data-font="'JetBrains Mono', monospace" data-font-name="JetBrains">JetBrains</div>
                            <div class="font-option font-anonymous" data-font="'Anonymous Pro', monospace" data-font-name="Anonymous">Anonymous</div>
                        </div>
                    </div>
                    <div class="note-content" contenteditable="true" style="font-size: ${defaultFontSize}px; font-family: ${defaultFontFamily}"></div>
                    <div class="note-tags"></div>
                    <div class="note-footer">
                        <span class="note-date">${dateString}</span>
                        <div class="note-actions">
                            <button class="note-btn note-pin" title="PIN ENTRY"><i class="fas fa-thumbtack"></i></button>
                            <button class="note-btn note-color-toggle" title="CHANGE HUE"><i class="fas fa-palette"></i></button>
                            <button class="note-btn note-archive" title="ARCHIVE SCRAP"><i class="fas fa-archive"></i></button>
                            <button class="note-btn note-delete" title="ERASE"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div class="color-picker">
                        <div class="color-option note-color-default selected" data-color="default" title="DEFAULT"></div>
                        <div class="color-option note-color-red" data-color="red" title="RED"></div>
                        <div class="color-option note-color-blue" data-color="blue" title="BLUE"></div>
                        <div class="color-option note-color-green" data-color="green" title="GREEN"></div>
                        <div class="color-option note-color-yellow" data-color="yellow" title="YELLOW"></div>
                        <div class="color-option note-color-purple" data-color="purple" title="PURPLE"></div>
                    </div>
                `;

                // Apply priority class
                if (priority !== 'none') {
                    noteElement.classList.add(`priority-${priority}`);
                }

                notesContainer.prepend(noteElement);
                attachNoteEventListeners(noteElement, noteId);

                // Clear title input
                noteTitleInput.value = '';

                // Save notes
                saveNotes();

                // Remove new-note class after animation
                setTimeout(() => {
                    noteElement.classList.remove('new-note');
                }, 400);

                filterNotes(); // Re-filter after adding new note
            }

            function attachNoteEventListeners(noteElement, noteId) {
                const pinBtn = noteElement.querySelector('.note-pin');
                const colorToggleBtn = noteElement.querySelector('.note-color-toggle');
                const archiveBtn = noteElement.querySelector('.note-archive');
                const deleteBtn = noteElement.querySelector('.note-delete');
                const noteColorPicker = noteElement.querySelector('.color-picker');
                const noteColorOptions = noteElement.querySelectorAll('.color-picker .color-option');
                const header = noteElement.querySelector('.note-header');
                const content = noteElement.querySelector('.note-content');
                const fontSizeSlider = noteElement.querySelector('.font-size-slider');
                const fontSizeValueSpan = noteElement.querySelector('.slider-value');
                const fontDropdownBtn = noteElement.querySelector('.font-dropdown-btn');
                const fontDropdownContent = noteElement.querySelector('.font-dropdown-content');
                const fontOptions = noteElement.querySelectorAll('.font-dropdown-content .font-option');
                const formatBtns = noteElement.querySelectorAll('.format-btn[data-command]');

                pinBtn.addEventListener('click', () => togglePinNote(noteId));
                colorToggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent document click from immediately closing
                    noteColorPicker.style.display = noteColorPicker.style.display === 'flex' ? 'none' : 'flex';
                });
                archiveBtn.addEventListener('click', () => toggleArchiveNote(noteId));
                deleteBtn.addEventListener('click', () => deleteNote(noteId));

                noteColorOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        changeNoteColor(noteId, this.dataset.color);
                        noteColorPicker.style.display = 'none'; // Hide after selection
                    });
                });

                // Close color picker when clicking outside of the note
                document.addEventListener('click', function(event) {
                    if (!noteElement.contains(event.target) && noteColorPicker.style.display === 'flex') {
                        noteColorPicker.style.display = 'none';
                    }
                });


                header.addEventListener('input', saveNotes);
                content.addEventListener('input', saveNotes);

                // Font size slider for individual note
                fontSizeSlider.addEventListener('input', function() {
                    const newSize = this.value;
                    fontSizeValueSpan.textContent = newSize;
                    content.style.fontSize = `${newSize}px`;
                    noteElement.dataset.fontSize = newSize; // Update data attribute
                    saveNotes();
                });

                // Font dropdown for individual note
                fontDropdownBtn.addEventListener('click', function(event) {
                    event.stopPropagation(); // Prevent document click from closing immediately
                    fontDropdownContent.classList.toggle('show');
                });

                fontOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const newFontFamily = this.dataset.font;
                        const newFontName = this.dataset.fontName;
                        noteElement.querySelector('.selected-font').textContent = newFontName;
                        content.style.fontFamily = newFontFamily;
                        noteElement.dataset.fontFamily = newFontFamily; // Update data attribute
                        noteElement.dataset.fontName = newFontName; // Update data attribute
                        fontDropdownContent.classList.remove('show');
                        saveNotes();
                    });
                });

                // Close dropdown when clicking outside of this note's dropdown
                document.addEventListener('click', function(event) {
                    if (!noteElement.contains(event.target) && fontDropdownContent.classList.contains('show')) {
                        fontDropdownContent.classList.remove('show');
                    }
                });

                // Formatting buttons (bold, italic, underline, align, color)
                formatBtns.forEach(button => {
                    button.addEventListener('click', function() {
                        const command = this.dataset.command;
                        const value = this.value; // For color input

                        content.focus(); // Ensure contenteditable is focused
                        if (command === 'foreColor') {
                            document.execCommand(command, false, value);
                        } else {
                            document.execCommand(command, false, null);
                        }
                        saveNotes();
                        // Update active state of buttons if applicable
                        updateFormatButtonStates(noteElement);
                    });
                });

                // Update formatting button states when selection changes
                content.addEventListener('mouseup', () => updateFormatButtonStates(noteElement));
                content.addEventListener('keyup', () => updateFormatButtonStates(noteElement));
                content.addEventListener('input', () => updateFormatButtonStates(noteElement));

                // Initial update of format button states
                updateFormatButtonStates(noteElement);
            }

            function updateFormatButtonStates(noteElement) {
                const content = noteElement.querySelector('.note-content');
                if (!content) return;

                const formatBtns = noteElement.querySelectorAll('.format-btn[data-command]');

                formatBtns.forEach(button => {
                    const command = button.dataset.command;
                    if (['bold', 'italic', 'underline'].includes(command)) {
                        if (document.queryCommandState(command)) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                    } else if (['justifyLeft', 'justifyCenter', 'justifyRight'].includes(command)) {
                        const alignment = window.getComputedStyle(content).textAlign;
                        if (
                            (command === 'justifyLeft' && alignment === 'left') ||
                            (command === 'justifyCenter' && alignment === 'center') ||
                            (command === 'justifyRight' && alignment === 'right')
                        ) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                    }
                });
            }

            function deleteNote(id) {
                const noteToDelete = document.querySelector(`.note[data-id="${id}"]`);
                if (noteToDelete) {
                    noteToDelete.classList.add('deleting');
                    setTimeout(() => {
                        noteToDelete.remove();
                        saveNotes();
                        filterNotes(); // Re-filter after deletion
                    }, 300);
                }
            }

            function togglePinNote(id) {
                const note = document.querySelector(`.note[data-id="${id}"]`);
                if (note) {
                    note.classList.toggle('pinned');
                    if (note.classList.contains('pinned')) {
                        notesContainer.prepend(note);
                    }
                    saveNotes();
                    filterNotes(); // Re-filter to reorder
                }
            }

            function toggleArchiveNote(id) {
                const note = document.querySelector(`.note[data-id="${id}"]`);
                if (note) {
                    note.classList.toggle('archived');
                    saveNotes();
                    filterNotes(); // Re-filter to hide/show
                }
            }

            function toggleArchivedNotes() {
                showArchived = !showArchived;
                localStorage.setItem('brutal-notes-show-archived', showArchived); // Persist state
                toggleArchivedBtn.innerHTML = showArchived ?
                    '<i class="fas fa-eye-slash"></i> HIDE ARCHIVED' :
                    '<i class="fas fa-eye"></i> SHOW ARCHIVED';
                filterNotes();
            }

            function changeNoteColor(id, color) {
                const note = document.querySelector(`.note[data-id="${id}"]`);
                if (note) {
                    // Remove all color classes
                    note.classList.remove('note-color-default', 'note-color-red', 'note-color-blue',
                                         'note-color-green', 'note-color-yellow', 'note-color-purple');

                    // Add new color class
                    note.classList.add(`note-color-${color}`);

                    // Update selected visual in the note's color picker
                    const noteColorOptions = note.querySelectorAll('.color-picker .color-option');
                    noteColorOptions.forEach(opt => {
                        opt.classList.remove('selected');
                        if (opt.dataset.color === color) {
                            opt.classList.add('selected');
                        }
                    });

                    saveNotes();
                }
            }

            function clearAllNotes() {
                if (confirm('ARE YOU SURE YOU WANT TO BURN ALL ENTRIES? THIS CANNOT BE UNDONE. CONFRIM?')) {
                    notesContainer.innerHTML = '';
                    localStorage.removeItem('brutal-notes');
                    filterNotes(); // Update empty state
                }
            }

            function saveNotes() {
                const notes = [];

                document.querySelectorAll('.note').forEach(note => {
                    notes.push({
                        id: note.dataset.id,
                        title: note.querySelector('.note-header').textContent,
                        content: note.querySelector('.note-content').innerHTML,
                        date: note.querySelector('.note-date').textContent,
                        fontSize: note.dataset.fontSize || '16', // Get from data attribute
                        fontFamily: note.dataset.fontFamily || "'Source Code Pro', monospace", // Get from data attribute
                        fontName: note.dataset.fontName || "Source Code Pro",
                        pinned: note.classList.contains('pinned'),
                        archived: note.classList.contains('archived'),
                        priority: note.dataset.priority || 'none',
                        color: Array.from(note.classList).find(cls => cls.startsWith('note-color-'))?.replace('note-color-', '') || 'default',
                        randomRotation: note.style.getPropertyValue('--random-rotation'),
                        randomTapeRotation: note.style.getPropertyValue('--random-tape-rotation')
                    });
                });

                localStorage.setItem('brutal-notes', JSON.stringify(notes));
            }

            function loadNotes() {
                const savedNotes = localStorage.getItem('brutal-notes');
                notesContainer.innerHTML = ''; // Clear existing notes before loading

                if (savedNotes) {
                    const notes = JSON.parse(savedNotes);

                    // Sort notes to display pinned ones first
                    notes.sort((a, b) => (b.pinned - a.pinned));

                    notes.forEach(note => {
                        const noteElement = document.createElement('div');
                        noteElement.className = `note note-color-${note.color || 'default'}`;
                        noteElement.dataset.id = note.id;
                        noteElement.dataset.priority = note.priority || 'none';
                        noteElement.dataset.fontSize = note.fontSize || defaultFontSize; // Set from saved data
                        noteElement.dataset.fontFamily = note.fontFamily || defaultFontFamily; // Set from saved data
                        noteElement.dataset.fontName = note.fontName || defaultFontName;
                        noteElement.style.setProperty('--random-rotation', note.randomRotation || (Math.random() * 4 - 2).toFixed(2));
                        noteElement.style.setProperty('--random-tape-rotation', note.randomTapeRotation || (Math.random() * 10 - 5).toFixed(2));


                        if (note.pinned) noteElement.classList.add('pinned');
                        if (note.archived) noteElement.classList.add('archived');
                        if (note.priority !== 'none') noteElement.classList.add(`priority-${note.priority}`);

                        noteElement.innerHTML = `
                            <div class="tape"></div>
                            <h3 class="note-header" contenteditable="true">${note.title}</h3>
                            <div class="format-controls">
                                <button class="format-btn" data-command="bold" title="BOLD"><i class="fas fa-bold"></i></button>
                                <button class="format-btn" data-command="italic" title="ITALIC"><i class="fas fa-italic"></i></button>
                                <button class="format-btn" data-command="underline" title="UNDERLINE"><i class="fas fa-underline"></i></button>
                                <button class="format-btn" data-command="justifyLeft" title="LEFT ALIGN"><i class="fas fa-align-left"></i></button>
                                <button class="format-btn" data-command="justifyCenter" title="CENTER ALIGN"><i class="fas fa-align-center"></i></button>
                                <button class="format-btn" data-command="justifyRight" title="RIGHT ALIGN"><i class="fas fa-align-right"></i></button>
                                <input type="color" class="format-btn" data-command="foreColor" title="FONT COLOR" value="#1A1A1A">
                            </div>
                            <div class="slider-container">
                                <label class="control-label"><i class="fas fa-text-height"></i> FONT SIZE</label>
                                <input type="range" min="8" max="48" value="${note.fontSize}" class="slider font-size-slider">
                                <span class="slider-value">${note.fontSize}</span>
                            </div>
                            <div class="font-dropdown">
                                <button class="font-dropdown-btn">
                                    <span class="selected-font">${note.fontName}</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <div class="font-dropdown-content">
                                    <div class="font-option font-monospace" data-font="'Courier New', monospace" data-font-name="Monospace">Monospace</div>
                                    <div class="font-option font-sans" data-font="'Arial', sans-serif" data-font-name="Sans">Sans</div>
                                    <div class="font-option font-serif" data-font="'Times New Roman', serif" data-font-name="Serif">Serif</div>
                                    <div class="font-option font-roboto" data-font="'Roboto', sans-serif" data-font-name="Roboto">Roboto</div>
                                    <div class="font-option font-playfair" data-font="'Playfair Display', serif" data-font-name="Playfair">Playfair</div>
                                    <div class="font-option font-code" data-font="'Source Code Pro', monospace" data-font-name="Source Code Pro">Source Code Pro</div>
                                    <div class="font-option font-comic" data-font="'Comic Neue', cursive" data-font-name="Comic Neue">Comic Neue</div>
                                    <div class="font-option font-bebas" data-font="'Bebas Neue', sans-serif" data-font-name="Bebas Neue">Bebas Neue</div>
                                    <div class="font-option font-pixel" data-font="'Press Start 2P', cursive" data-font-name="Press Start 2P">Press Start 2P</div>
                                    <div class="font-option font-rubik" data-font="'Rubik Mono One', sans-serif" data-font-name="Rubik Mono One">Rubik Mono One</div>
                                    <div class="font-option font-fredoka" data-font="'Fredoka One', cursive" data-font-name="Fredoka One">Fredoka One</div>
                                    <div class="font-option font-baloo" data-font="'Baloo 2', cursive" data-font-name="Baloo 2">Baloo 2</div>
                                    <div class="font-option font-modak" data-font="'Modak', cursive" data-font-name="Modak">Modak</div>
                                    <div class="font-option font-poppins" data-font="'Poppins', sans-serif" data-font-name="Poppins">Poppins</div>
                                    <div class="font-option font-archivo" data-font="'Archivo Black', sans-serif" data-font-name="Archivo Black">Archivo Black</div>
                                    <div class="font-option font-ultra" data-font="'Ultra', serif" data-font-name="Ultra">Ultra</div>
                                    <div class="font-option font-syne" data-font="'Syne Mono', monospace" data-font-name="Syne Mono">Syne Mono</div>
                                    <div class="font-option font-major" data-font="'Major Mono Display', monospace" data-font-name="Major Mono Display">Major Mono Display</div>
                                    <div class="font-option font-bungee" data-font="'Bungee', cursive" data-font-name="Bungee">Bungee</div>
                                    <div class="font-option font-bungee-shade" data-font="'Bungee Shade', cursive" data-font-name="Bungee Shade">Bungee Shade</div>
                                    <div class="font-option font-blackops" data-font="'Black Ops One', cursive" data-font-name="Black Ops One">Black Ops One</div>
                                    <div class="font-option font-abril" data-font="'Abril Fatface', cursive" data-font-name="Abril Fatface">Abril Fatface</div>
                                    <div class="font-option font-montserrat" data-font="'Montserrat', sans-serif" data-font-name="Montserrat">Montserrat</div>
                                    <div class="font-option font-oswald" data-font="'Oswald', sans-serif" data-font-name="Oswald">Oswald</div>
                                    <div class="font-option font-raleway" data-font="'Raleway', sans-serif" data-font-name="Raleway">Raleway</div>
                                    <div class="font-option font-quicksand" data-font="'Quicksand', sans-serif" data-font-name="Quicksand">Quicksand</div>
                                    <div class="font-option font-pacifico" data-font="'Pacifico', cursive" data-font-name="Pacifico">Pacifico</div>
                                    <div class="font-option font-dancing" data-font="'Dancing Script', cursive" data-font-name="Dancing Script">Dancing Script</div>
                                    <div class="font-option font-caveat" data-font="'Caveat', cursive" data-font-name="Caveat">Caveat</div>
                                    <div class="font-option font-kalam" data-font="'Kalam', cursive" data-font-name="Kalam">Kalam</div>
                                    <div class="font-option font-amatic" data-font="'Amatic SC', cursive" data-font-name="Amatic SC">Amatic SC</div>
                                    <div class="font-option font-shadows" data-font="'Shadows Into Light', cursive" data-font-name="Shadows Into Light">Shadows Into Light</div>
                                    <div class="font-option font-indie" data-font="'Indie Flower', cursive" data-font-name="Indie Flower">Indie Flower</div>
                                    <div class="font-option font-special" data-font="'Special Elite', cursive" data-font-name="Special Elite">Special Elite</div>
                                    <div class="font-option font-vt323" data-font="'VT323', monospace" data-font-name="VT323">VT323</div>
                                    <div class="font-option font-ibm" data-font="'IBM Plex Mono', monospace" data-font-name="IBM Plex Mono">IBM Plex Mono</div>
                                    <div class="font-option font-space" data-font="'Space Mono', monospace" data-font-name="Space Mono">Space Mono</div>
                                    <div class="font-option font-work" data-font="'Work Sans', sans-serif" data-font-name="Work Sans">Work Sans</div>
                                    <div class="font-option font-fira" data-font="'Fira Sans', sans-serif" data-font-name="Fira Sans">Fira Sans</div>
                                    <div class="font-option font-noto" data-font="'Noto Sans', sans-serif" data-font-name="Noto Sans">Noto Sans</div>
                                    <div class="font-option font-open" data-font="'Open Sans', sans-serif" data-font-name="Open Sans">Open Sans</div>
                                    <div class="font-option font-merriweather" data-font="'Merriweather', serif" data-font-name="Merriweather">Merriweather</div>
                                    <div class="font-option font-libre" data-font="'Libre Baskerville', serif" data-font-name="Libre Baskerville">Libre Baskerville</div>
                                    <div class="font-option font-dm" data-font="'DM Serif Display', serif" data-font-name="DM Serif Display">DM Serif Display</div>
                                    <div class="font-option font-alfa" data-font="'Alfa Slab One', cursive" data-font-name="Alfa Slab One">Alfa Slab One</div>
                                    <div class="font-option font-paytone" data-font="'Paytone One', sans-serif" data-font-name="Paytone One">Paytone One</div>
                                    <div class="font-option font-luckiest" data-font="'Luckiest Guy', cursive" data-font-name="Luckiest Guy">Luckiest Guy</div>
                                    <div class="font-option font-chewy" data-font="'Chewy', cursive" data-font-name="Chewy">Chewy</div>
                                    <div class="font-option font-sigmar" data-font="'Sigmar One', cursive" data-font-name="Sigmar One">Sigmar One</div>
                                    <div class="font-option font-righteous" data-font="'Righteous', cursive" data-font-name="Righteous">Righteous</div>
                                    <div class="font-option font-lobster" data-font="'Lobster', cursive" data-font-name="Lobster">Lobster</div>
                                    <div class="font-option font-patua" data-font="'Patua One', cursive" data-font-name="Patua One">Patua One</div>
                                    <div class="font-option font-acme" data-font="'Acme', sans-serif" data-font-name="Acme">Acme</div>
                                    <div class="font-option font-josefin" data-font="'Josefin Sans', sans-serif" data-font-name="Josefin Sans">Josefin Sans</div>
                                    <div class="font-option font-josefin-slab" data-font="'Josefin Slab', serif" data-font-name="Josefin Slab">Josefin Slab</div>
                                    <div class="font-option font-arvo" data-font="'Arvo', serif" data-font-name="Arvo">Arvo</div>
                                    <div class="font-option font-volkhov" data-font="'Volkhov', serif" data-font-name="Volkhov">Volkhov</div>
                                    <div class="font-option font-crimson" data-font="'Crimson Text', serif" data-font-name="Crimson Text">Crimson Text</div>
                                    <div class="font-option font-cardo" data-font="'Cardo', serif" data-font-name="Cardo">Cardo</div>
                                    <div class="font-option font-alegreya" data-font="'Alegreya', serif" data-font-name="Alegreya">Alegreya</div>
                                    <div class="font-option font-yeseva" data-font="'Yeseva One', cursive" data-font-name="Yeseva One">Yeseva One</div>
                                    <div class="font-option font-philosopher" data-font="'Philosopher', sans-serif" data-font-name="Philosopher">Philosopher</div>
                                    <div class="font-option font-prata" data-font="'Prata', serif" data-font-name="Prata">Prata</div>
                                    <div class="font-option font-cormorant" data-font="'Cormorant', serif" data-font-name="Cormorant">Cormorant</div>
                                    <div class="font-option font-unica" data-font="'Unica One', cursive" data-font-name="Unica One">Unica One</div>
                                    <div class="font-option font-changa" data-font="'Changa One', cursive" data-font-name="Changa One">Changa One</div>
                                    <div class="font-option font-staat" data-font="'Staatliches', cursive" data-font-name="Staatliches">Staatliches</div>
                                    <div class="font-option font-knewave" data-font="'Knewave', cursive" data-font-name="Knewave">Knewave</div>
                                    <div class="font-option font-boogaloo" data-font="'Boogaloo', cursive" data-font-name="Boogaloo">Boogaloo</div>
                                    <div class="font-option font-bangers" data-font="'Bangers', cursive" data-font-name="Bangers">Bangers</div>
                                    <div class="font-option font-gloria" data-font="'Gloria Hallelujah', cursive" data-font-name="Gloria Hallelujah">Gloria Hallelujah</div>
                                    <div class="font-option font-rock" data-font="'Rock Salt', cursive" data-font-name="Rock Salt">Rock Salt</div>
                                    <div class="font-option font-marker" data-font="'Permanent Marker', cursive" data-font-name="Permanent Marker">Permanent Marker</div>
                                    <div class="font-option font-nothing" data-font="'Nothing You Could Do', cursive" data-font-name="Nothing You Could Do">Nothing You Could Do</div>
                                    <div class="font-option font-reenie" data-font="'Reenie Beanie', cursive" data-font-name="Reenie Beanie">Reenie Beanie</div>
                                    <div class="font-option font-handlee" data-font="'Handlee', cursive" data-font-name="Handlee">Handlee</div>
                                    <div class="font-option font-gochi" data-font="'Gochi Hand', cursive" data-font-name="Gochi Hand">Gochi Hand</div>
                                    <div class="font-option font-nanum" data-font="'Nanum Pen Script', cursive" data-font-name="Nanum Pen Script">Nanum Pen Script</div>
                                    <div class="font-option font-homemade" data-font="'Homemade Apple', cursive" data-font-name="Homemade Apple">Homemade Apple</div>
                                    <div class="font-option font-covered" data-font="'Covered By Your Grace', cursive" data-font-name="Covered By Your Grace">Covered By Your Grace</div>
                                    <div class="font-option font-walter" data-font="'Walter Turncoat', cursive" data-font-name="Walter Turncoat">Walter Turncoat</div>
                                    <div class="font-option font-berkshire" data-font="'Berkshire Swash', cursive" data-font-name="Berkshire Swash">Berkshire Swash</div>
                                    <div class="font-option font-satisfy" data-font="'Satisfy', cursive" data-font-name="Satisfy">Satisfy</div>
                                    <div class="font-option font-kaushan" data-font="'Kaushan Script', cursive" data-font-name="Kaushan Script">Kaushan Script</div>
                                    <div class="font-option font-marck" data-font="'Marck Script', cursive" data-font-name="Marck Script">Marck Script</div>
                                    <div class="font-option font-yellowtail" data-font="'Yellowtail', cursive" data-font-name="Yellowtail">Yellowtail</div>
                                    <div class="font-option font-great" data-font="'Great Vibes', cursive" data-font-name="Great Vibes">Great Vibes</div>
                                    <div class="font-option font-parisienne" data-font="'Parisienne', cursive" data-font-name="Parisienne">Parisienne</div>
                                    <div class="font-option font-qwigley" data-font="'Qwigley', cursive" data-font-name="Qwigley">Qwigley</div>
                                    <div class="font-option font-tangerine" data-font="'Tangerine', cursive" data-font-name="Tangerine">Tangerine</div>
                                    <div class="font-option font-itim" data-font="'Itim', cursive" data-font-name="Itim">Itim</div>
                                    <div class="font-option font-schoolbell" data-font="'Schoolbell', cursive" data-font-name="Schoolbell">Schoolbell</div>
                                    <div class="font-option font-short" data-font="'Short Stack', cursive" data-font-name="Short Stack">Short Stack</div>
                                    <div class="font-option font-neucha" data-font="'Neucha', cursive" data-font-name="Neucha">Neucha</div>
                                    <div class="font-option font-annie" data-font="'Annie Use Your Telescope', cursive" data-font-name="Annie Use Your Telescope">Annie Use Your Telescope</div>
                                    <div class="font-option font-rainbow" data-font="'Over the Rainbow', cursive" data-font-name="Over the Rainbow">Over the Rainbow</div>
                                    <div class="font-option font-sunshiney" data-font="'Sunshiney', cursive" data-font-name="Sunshiney">Sunshiney</div>
                                    <div class="font-option font-love" data-font="'Love Ya Like A Sister', cursive" data-font-name="Love Ya Like A Sister">Love Ya Like A Sister</div>
                                    <div class="font-option font-kranky" data-font="'Kranky', cursive" data-font-name="Kranky">Kranky</div>
                                    <div class="font-option font-mountains" data-font="'Mountains of Christmas', cursive" data-font-name="Mountains of Christmas">Mountains of Christmas</div>
                                    <div class="font-option font-butcherman" data-font="'Butcherman', cursive" data-font-name="Butcherman">Butcherman</div>
                                    <div class="font-option font-eater" data-font="'Eater', cursive" data-font-name="Eater">Eater</div>
                                    <div class="font-option font-creepster" data-font="'Creepster', cursive" data-font-name="Creepster">Creepster</div>
                                    <div class="font-option font-frijole" data-font="'Frijole', cursive" data-font-name="Frijole">Frijole</div>
                                    <div class="font-option font-rye" data-font="'Rye', cursive" data-font-name="Rye">Rye</div>
                                    <div class="font-option font-smokum" data-font="'Smokum', cursive" data-font-name="Smokum">Smokum</div>
                                    <div class="font-option font-unifraktur" data-font="'UnifrakturMaguntia', cursive" data-font-name="UnifrakturMaguntia">UnifrakturMaguntia</div>
                                    <div class="font-option font-astloch" data-font="'Astloch', cursive" data-font-name="Astloch">Astloch</div>
                                    <div class="font-option font-emblema" data-font="'Emblema One', cursive" data-font-name="Emblema One">Emblema One</div>
                                    <div class="font-option font-faster" data-font="'Faster One', cursive" data-font-name="Faster One">Faster One</div>
                                    <div class="font-option font-federo" data-font="'Federo', sans-serif" data-font-name="Federo">Federo</div>
                                    <div class="font-option font-gravitas" data-font="'Gravitas One', cursive" data-font-name="Gravitas One">Gravitas One</div>
                                    <div class="font-option font-monofett" data-font="'Monofett', cursive" data-font-name="Monofett">Monofett</div>
                                    <div class="font-option font-nosifer" data-font="'Nosifer', cursive" data-font-name="Nosifer">Nosifer</div>
                                    <div class="font-option font-plaster" data-font="'Plaster', cursive" data-font-name="Plaster">Plaster</div>
                                    <div class="font-option font-ribeye-marrow" data-font="'Ribeye Marrow', cursive" data-font-name="Ribeye Marrow">Ribeye Marrow</div>
                                    <div class="font-option font-ribeye" data-font="'Ribeye', cursive" data-font-name="Ribeye">Ribeye</div>
                                    <div class="font-option font-romanesco" data-font="'Romanesco', cursive" data-font-name="Romanesco">Romanesco</div>
                                    <div class="font-option font-ruslan" data-font="'Ruslan Display', cursive" data-font-name="Ruslan Display">Ruslan Display</div>
                                    <div class="font-option font-skranji" data-font="'Skranji', cursive" data-font-name="Skranji">Skranji</div>
                                    <div class="font-option font-stalinist" data-font="'Stalinist One', cursive" data-font-name="Stalinist One">Stalinist One</div>
                                    <div class="font-option font-trade" data-font="'Trade Winds', cursive" data-font-name="Trade Winds">Trade Winds</div>
                                    <div class="font-option font-underdog" data-font="'Underdog', cursive" data-font-name="Underdog">Underdog</div>
                                    <div class="font-option font-vast" data-font="'Vast Shadow', cursive" data-font-name="Vast Shadow">Vast Shadow</div>
                                    <div class="font-option font-vibur" data-font="'Vibur', cursive" data-font-name="Vibur">Vibur</div>
                                    <div class="font-option font-zilla" data-font="'Zilla Slab Highlight', cursive" data-font-name="Zilla Slab Highlight">Zilla Slab Highlight</div>
                                    <div class="font-option font-firamono" data-font="'Fira Mono', monospace" data-font-name="Fira Mono">Fira Mono</div>
                                    <div class="font-option font-chivomono" data-font="'Chivo Mono', monospace" data-font-name="Chivo Mono">Chivo Mono</div>
                                    <div class="font-option font-fragment" data-font="'Fragment Mono', monospace" data-font-name="Fragment">Fragment</div>
                                    <div class="font-option font-redhatmono" data-font="'Red Hat Mono', monospace" data-font-name="Red Hat Mono">Red Hat Mono</div>
                                    <div class="font-option font-sharetech" data-font="'Share Tech Mono', monospace" data-font-name="Share Tech">Share Tech</div>
                                    <div class="font-option font-synetactile" data-font="'Syne Tactile', cursive" data-font-name="Syne Tactile">Syne Tactile</div>
                                    <div class="font-option font-tourney" data-font="'Tourney', cursive" data-font-name="Tourney">Tourney</div>
                                    <div class="font-option font-martian" data-font="'Martian Mono', monospace" data-font-name="Martian">Martian</div>
                                    <div class="font-option font-jetbrains" data-font="'JetBrains Mono', monospace" data-font-name="JetBrains">JetBrains</div>
                                    <div class="font-option font-anonymous" data-font="'Anonymous Pro', monospace" data-font-name="Anonymous">Anonymous</div>
                                </div>
                            </div>
                            <div class="note-content" contenteditable="true" style="font-size: ${note.fontSize}px; font-family: ${note.fontFamily}">${note.content}</div>
                            <div class="note-tags"></div>
                            <div class="note-footer">
                                <span class="note-date">${note.date}</span>
                                <div class="note-actions">
                                    <button class="note-btn note-pin" title="PIN ENTRY"><i class="fas fa-thumbtack"></i></button>
                                    <button class="note-btn note-color-toggle" title="CHANGE HUE"><i class="fas fa-palette"></i></button>
                                    <button class="note-btn note-archive" title="ARCHIVE SCRAP"><i class="fas fa-archive"></i></button>
                                    <button class="note-btn note-delete" title="ERASE"><i class="fas fa-times"></i></button>
                                </div>
                            </div>
                            <div class="color-picker">
                                <div class="color-option note-color-default" data-color="default" title="DEFAULT"></div>
                                <div class="color-option note-color-red" data-color="red" title="RED"></div>
                                <div class="color-option note-color-blue" data-color="blue" title="BLUE"></div>
                                <div class="color-option note-color-green" data-color="green" title="GREEN"></div>
                                <div class="color-option note-color-yellow" data-color="yellow" title="YELLOW"></div>
                                <div class="color-option note-color-purple" data-color="purple" title="PURPLE"></div>
                            </div>
                        `;

                        notesContainer.appendChild(noteElement);
                        attachNoteEventListeners(noteElement, note.id);

                        // Highlight the saved color in the note's color picker
                        const noteColorOptionsLoaded = noteElement.querySelectorAll('.color-picker .color-option');
                        noteColorOptionsLoaded.forEach(opt => {
                            if (opt.dataset.color === note.color) {
                                opt.classList.add('selected');
                            }
                        });
                    });
                }
            }


            function filterNotes() {
                const searchTerm = searchInput.value.toLowerCase();
                const notes = document.querySelectorAll('.note');
                let anyNotesVisible = false;

                notes.forEach(note => {
                    const title = note.querySelector('.note-header').textContent.toLowerCase();
                    const content = note.querySelector('.note-content').textContent.toLowerCase();
                    const isPinned = note.classList.contains('pinned');
                    const isArchived = note.classList.contains('archived');
                    const priority = note.dataset.priority || 'none';

                    let matchesSearch = title.includes(searchTerm) || content.includes(searchTerm);
                    let matchesFilter = true;

                    switch (currentFilter) {
                        case 'pinned':
                            matchesFilter = isPinned;
                            break;
                        case 'archived':
                            matchesFilter = isArchived;
                            break;
                        case 'high':
                            matchesFilter = priority === 'high';
                            break;
                        case 'medium':
                            matchesFilter = priority === 'medium';
                            break;
                        case 'low':
                            matchesFilter = priority === 'low';
                            break;
                        case 'all':
                        default:
                            // If filter is 'all', show archived only if showArchived is true
                            matchesFilter = !isArchived || showArchived;
                            break;
                    }

                    if (matchesSearch && matchesFilter) {
                        note.style.display = 'flex';
                        anyNotesVisible = true;
                    } else {
                        note.style.display = 'none';
                    }
                });

                // Show message if no notes match the filter
                let noNotesMessage = document.querySelector('.no-notes');

                if (!anyNotesVisible) {
                    if (!noNotesMessage) {
                        noNotesMessage = document.createElement('div');
                        noNotesMessage.className = 'no-notes';
                        noNotesMessage.textContent = 'NO ENTRIES FOUND MATCHING YOUR CRITERIA. ADJUST FILTERS OR SEARCH.';
                        notesContainer.appendChild(noNotesMessage);
                    }
                } else if (noNotesMessage) {
                    noNotesMessage.remove();
                }
            }

            function exportNotes() {
                const notes = [];

                document.querySelectorAll('.note').forEach(note => {
                    notes.push({
                        id: note.dataset.id,
                        title: note.querySelector('.note-header').textContent,
                        content: note.querySelector('.note-content').innerHTML,
                        date: note.querySelector('.note-date').textContent,
                        fontSize: note.dataset.fontSize || '16',
                        fontFamily: note.dataset.fontFamily || "'Source Code Pro', monospace",
                        fontName: note.dataset.fontName || "Source Code Pro",
                        pinned: note.classList.contains('pinned'),
                        archived: note.classList.contains('archived'),
                        priority: note.dataset.priority || 'none',
                        color: Array.from(note.classList).find(cls => cls.startsWith('note-color-'))?.replace('note-color-', '') || 'default',
                        randomRotation: note.style.getPropertyValue('--random-rotation'),
                        randomTapeRotation: note.style.getPropertyValue('--random-tape-rotation')
                    });
                });

                const dataStr = JSON.stringify(notes, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportName = 'brutal-notes-export-' + new Date().toISOString().slice(0, 10) + '.json';

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportName);
                linkElement.click();
            }

            function importNotes(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedNotes = JSON.parse(e.target.result);

                        if (confirm(`IMPORT ${importedNotes.length} ENTRIES? THIS WILL OVERWRITE YOUR CURRENT DATA. CONFIRM?`)) {
                            localStorage.setItem('brutal-notes', JSON.stringify(importedNotes));
                            notesContainer.innerHTML = '';
                            loadNotes();
                            filterNotes(); // Re-filter after import
                        }
                    } catch (error) {
                        alert('ERROR IMPORTING DATA: INVALID FILE OR CORRUPTED. RE-TRY.');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);

                // Reset the input so the same file can be imported again if needed
                event.target.value = '';
            }

            // High-quality screenshot capture function
            function captureScreen() {
                // Show loading indicator
                const oldText = captureScreenBtn.innerHTML;
                captureScreenBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> PROCESSING...';
                captureScreenBtn.disabled = true;

                // First capture the screen WITHOUT the flash
                html2canvas(document.body, {
                    scale: 3, // Triple resolution for crisp quality
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: -window.scrollY,
                    windowWidth: document.documentElement.scrollWidth,
                    windowHeight: document.documentElement.scrollHeight,
                    backgroundColor: getComputedStyle(document.body).backgroundColor, // Use current background color
                    letterRendering: true,
                    quality: 1,
                    ignoreElements: (element) => {
                        return element.classList && element.classList.contains('flash-effect');
                    }
                }).then(canvas => {
                    // Create a temporary canvas for final processing
                    const finalCanvas = document.createElement('canvas');
                    finalCanvas.width = canvas.width;
                    finalCanvas.height = canvas.height;
                    const ctx = finalCanvas.getContext('2d');

                    // Apply slight sharpening and contrast
                    ctx.filter = 'contrast(1.15) brightness(1.05)';
                    ctx.drawImage(canvas, 0, 0);
                    ctx.filter = 'none';

                    // Create download link
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-');
                    link.download = `brutal-notes-capture-${timestamp}.png`;
                    link.href = finalCanvas.toDataURL('image/png', 1.0);

                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    // Show flash effect after download
                    const flash = document.createElement('div');
                    flash.className = 'flash-effect';
                    document.body.appendChild(flash);

                    // Remove flash after animation
                    setTimeout(() => {
                        flash.remove();
                    }, 400); // Shorter flash time

                }).catch(err => {
                    console.error('ERROR CAPTURING SCREENSHOT:', err);
                    alert('ERROR CAPTURING SCREENSHOT. RE-TRY.');
                }).finally(() => {
                    // Restore button state
                    captureScreenBtn.innerHTML = oldText;
                    captureScreenBtn.disabled = false;
                });
            }
        });
    </script>
</body>
</html>
